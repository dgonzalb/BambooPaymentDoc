---
title: "Operations"
linkTitle: "Operations"
date: 2023-03-02T11:40:29-05:00
Description: >
  Create a purchase using the API flow providing its basic information. Furthermore, explore the different operations over existing purchases.
weight: 10
tags: ["subtopic"]
---

## Configuring the authentication
All methods used in Purchase API require the following authentication headers.

| Key | Value | Comments |
|---|---|---|
| `Content-Type` | `application/json` | With this header, the request will be transmitted in _JSON_ format. |
| `Authorization` | `Basic {{Merchant Private Key}}` | Send the `{{Merchant Private Key}}` (your merchant identifier) and the word `Basic`.<br>Example: `Basic RVkeLr-86_iTzSMLvDtuyQ-1zqIcsmFG-oSzncn_uFv-nj7bhB3rtZg__` |

## Setting the language of the response codes
You can receive the error description by relying on localization features. To do this, you need to send the `lang` header in your integration, using any of the following languages in **ISO 639-1** format.

<div id="shortTable"></div>

| Code | Language |
|:-:|---|
| `en` | English.<br>_This is the default language. If you don't send this header or set a non-existent language, you will receive errors in this language._ |
| `es` | Spanish. |
| `pt` | Portuguese. |

## Purchase API methods
The operations exposed by the _**Purchase API**_ allow you to perform several actions over Purchases. You have available the following methods.

* [Create a purchase](#create-a-purchase)
* [Confirm a purchase](#confirm-a-purchase)
* [Get purchases](#get-purchases)

### Create a purchase
Create a basic purchase in Bamboo Payment.

#### Request URL
You must invoke a **POST** request to the following URLs according to your needs.

* **Production**: `https://api.bamboopayment.com/v1/api/purchase`
* **Stage**: `https://api.stage.bamboopayment.com/v1/api/purchase`

#### Request parameters

| Parameter | Type | Mandatory? | Description |
|---|---|:-:|---|
| `PaymentMediaId` | `integer` | No <sup>1</sup> | Corresponds to the Id of the payment method you want to use. This parameter is only for Alternative payment methods (transfer, cash, and processing that requires customer redirection). |
| `TrxToken` | `string` | No <sup>1</sup> | This parameter refers to the token used to identify a customer's card. |
| `Order` | `string` | Yes | Order number generated by the merchant. |
| `Amount` | `number` | Yes | Amount of the purchase. This value must be greater than zero.<br>If you must include decimals in the amount, concatenate the decimal places without de decimal point. Example `12,25` > `1225`. |
| `Currency` | `string` | Yes | Currency of the purchase, according to ISO-4217. Find the possible values in the Currencies table of [each country](/en/docs/payment-methods.html). |
| `Installments` | `integer` | No | This parameter refers to the number of payments that a credit card purchase is divided into. |
| `Capture` | `boolean` | No | Defines whether the purchase should be performed in one or two steps.<sup>2</sup><br><ul style="margin-bottom: initial;"><li>If `false`, only the authorization is processed, and the purchase is pre-authorized until the final confirmation through the commit and rollback calls.</li><li>If `true`, the transaction is authorized and captured (committed).</li></ul><br>All [payment methods and countries](/en/docs/payment-methods.html) may not support the pre-authorization feature. |
| `TargetCountryISO` | `string` | Yes | This parameter indicates the country where the payment will be processed.<br>Send the country using `ISO-3166-1` format. |
| `MetadataIn` | `object` | No | The Additional fields required by each payment method or acquirer. |
| `Customer` | `object` | Yes <sup>3</sup> | The `Customer` object provides the data of the person who performs the purchase. |
| `Customer` → `CommerceCustomerId` | `string` | No | Customer identifier.<br>The merchant generates and uses this value internally to identify the customer within the Bamboo Payment platform. |
| `Customer` → `Email` | `string` | Yes | Customer email address. |
| `Customer` → `FirstName` | `string` | No | Customer name. |
| `Customer` → `LastName` | `string` | No | Customer last name. |
| `Customer` → `PhoneNumber` | `string` | No | Customer contact telephone number. |
| `Customer` → `Enabled` | `boolean` | No | Indicates whether the user is enabled to operate. The default value is `true`. |
| `Customer` → `BillingAddress` | `object` | No | This parameter is the customer's billing address. |
| `Customer` → `BillingAddress`→`AddressID` | `integer` | No | Address Identifier. |
| `Customer` → `BillingAddress`→`AddressType` | `string` | No | Type of address. |
| `Customer` → `BillingAddress`→`Country` | `string` | No | Country of the address. |
| `Customer` → `BillingAddress`→`State` | `string` | No | State of the address. |
| `Customer` → `BillingAddress`→`City` | `string` | No | City of the address. |
| `Customer` → `BillingAddress`→`AddressDetail` | `string` | No | This parameter corresponds to the Additional information of the address, such as street, number, etc. |
| `Customer` → `BillingAddress`→`PostalCode` | `string` | No | Postal Code of the address. |
| `Customer` → `ShippingAddress` | `object` | No | The customer's shipping address. This address is where they want to receive their purchased product. This object has the same parameter as the  `Customer.BillingAddress` object. |
| `Customer` → `AdditionalData` | `string` | No | List of type `key:value` to store extra information. |
| `Customer` → `CaptureURL` | `string` | No | Card data capture URL.<br>This parameter contains the URL that should be loaded in an iframe to initiate the secure data capture process.<br>This only applies to Customers of type _Commerce_. |
| `Customer` → `DocumentTypeId` | `string` | No | Customer document type. Find the possible values in the Document types table of [each country](/en/docs/payment-methods.html). |
| `Customer` → `DocNumber` | `string` | No | Customer document Number. |
| `Tip` | `number` | No | Additional tip of the purchase if required. |
| `Description` | `string` | No | Optional description of the purchase. |
| `UniqueID` | `string` | No | Unique identifier of the purchase.<br>This optional value allows you to identify a unique purchase and avoid duplication of transactions in case of communication errors. For more information, refer to [Concepts]({{< ref "Concepts.md">}}#UniqueID). |
| `AdditionalData` | `string` | No | You can add additional information to the transaction (For example a `Key:Value` data list).<br>We return this information each time you consult the purchase. |
| `CustomerUserAgent` | `string` | No | User Agent of the customer who uses the service; for desktop devices, it should be the `UserAgent` reported by the browser, and for mobile, the information about the device, S.O. used, and App name. |


{{% alert title="Notes" color="info"%}}
* <sup>1</sup> The `PaymentMediaId` and `TrxToken` parameters are not required. Nevertheless, sending one of them is mandatory, depending on the flow you want to use.
* <sup>2</sup> All the payment methods may not support the pre-authorization feature. Review the [Countries and payment methods](/en/docs/payment-methods.html) section to check availability.
* <sup>3</sup> This object is not required if you create the purchase using [_CommerceToken_]({{< ref Registered-users.md >}}).
* Keep in mind that for the Anti-fraud system's correct functioning, we suggest sending additional data described in the [Anti-fraud]({{< ref "Antifraud.md" >}}) section.
{{% /alert %}}

##### Request example

```json
{
  "TrxToken":"OT__zq4aTY4T9TzSldeBKry-Wbx75QNbuT894jiYpVJ8SzQ_",
  "Order": "099927564",
  "Capture": true,
  "Amount": "10000",
  "Currency": "UYU",
  "TargetCountryISO": "UY",
  "Installments": 1,
  "Customer": {
    "Email": "john@mail.com",
    "FirstName": "John",
    "LastName": "Smith",
    "DocNumber": "12345672",
    "DocumentTypeId": 2,
    "PhoneNumber": "24022330",
    "BillingAddress": {
      "AddressType": 1,
      "Country": "Uruguay",
      "State": "Montevideo",
      "City": "MONTEVIDEO",
      "AddressDetail": "Av. Sarmiento 2260",
      "PostalCode": "150000"
    }
  },
  "DataUY": {
    "IsFinalConsumer": "true",
    "Invoice": "1000",
    "TaxableAmount": 0
  }
}
```

### Confirm a purchase
This method allows you to confirm a pre-authorized purchase.

{{% alert title="Note" color="info"%}}
All payment methods may not support the pre-authorization feature, and it’s available for the following countries.

<div style="text-align: center;">

<a href="en/docs/payment-methods/brazil.html"><img src="/assets/Flags/FlagBR.png" width="30" /></a>
<a href="en/docs/payment-methods/chile.html"><img src="/assets/Flags/FlagCL.png" width="30" /></a>
<a href="en/docs/payment-methods/colombia.html"><img src="/assets/Flags/FlagCO.png" width="30" /></a>
<a href="en/docs/payment-methods/uruguay.html"><img src="/assets/Flags/FlagUY.png" width="30" /></a>

</div>

{{% /alert %}}

#### Request URL
You must invoke a **POST** request to the following URLs according to your needs.

* **Production**: `https://api.bamboopayment.com/v1/api/purchase/{{PurchaseID}}/commit`
* **Stage**: `https://api.stage.bamboopayment.com/v1/api/purchase/{{PurchaseID}}/commit`

#### Request parameters
The request body is optional to confirm a purchase. If you don’t send any request, the method commits the pre-authorized purchase by its original amount.

The purchase amount may vary concerning the one sent in the initial purchase process, but the new amount cannot be higher than the original amount.

##### Request example
You must include the new amount in the request to confirm a purchase with a lower amount than the original. For example:

```json
{
  "Amount": 50
}
``` 

### Get Purchases
This method allows you to get the information of one or more purchases given the search criteria sent in the body.

#### Request URL
You must invoke a**GET** request to the following URLs according to your needs.

* **Production**: `https://api.bamboopayment.com/v1/api/purchase`
* **Stage**: `https://api.stage.bamboopayment.com/v1/api/purchase`

To get a specific purchase, include in the URL `/{{PurchaseID}}`. Example: `https://api.bamboopayment.com/v1/api/purchase/481561`.

#### Request parameters
The following parameters are only required when you want to get a list of purchases. Add the _PurchaseID_ to the Request URL when requesting a specific purchase.

{{% alert title="Note" color="info"%}}
All the parameters are optional. If you don’t send any parameters, all today's purchases will be listed.
{{% /alert %}}

| Parameter | Type | Description |
|---|---|---|---|
| `Authorized` | `boolean` | If the value is `true`, it returns only purchases that have been completed successfully. |
| `From` | `date` | Filter start date.<br>Format: `yyyyMMdd`. |
| `OrderNumber` | `string` | Merchant order number. |
| `PaymentMediaId` | `integer` | Identifier of the Payment Method used in the purchase. |
| `To` | `date` | Filter end date.<br>Format: `yyyyMMdd`. |


## Response parameters
You will get the same `Response` object regardless of the method you invoke. Only when you query purchases and the result has multiple results the `Response` returned will be an array.

The following table describes the parameters in the `Response` object relevant to the purchase, its possible next steps in the flow, and the errors that may have occurred.

| Parameter | Type | Description |
|---|---|---|
| `Response` | `object` | Parameters returned as the result of the purchase processing. |
| `Response` → `PurchaseId` | `integer` | Purchase identifier. |
| `Response` → `Created` | `date` | Date and time when the purchase was created.<br>Date format _**ISO-8601**_. | 
| `Response` → `Transaction` | `object` | This object is associated with the Purchase and has the information on the request sent and the response obtained from the corresponding payment method. |
| `Response` → `Transaction` → `TransactionID` | `integer` | Transaction identifier. |
| `Response` → `Transaction` → `Created` | `date` | Date and time when the transaction was created.<br>Date format _**ISO-8601**_. |
| `Response` → `Transaction` → `TransactionStatusId` | `integer` | Internal identifier of the transaction status. |
| `Response` → `Transaction` → `Status` | `string` | Current status of the transaction. |
| `Response` → `Transaction` → `ErrorCode` | `string` | Error code (if applicable) returned by the payment method. |
| `Response` → `Transaction` → `Description` | `string` | Description of the outcome of the transaction. |
| `Response` → `Transaction` → `ApprovalCode` | `string` | Approval code returned by the payment method. |
| `Response` → `RefundList` | `object` | This object has information on the purchase's refunds (partials or total). |
| `Response` → `RefundList` → `PurchaseRefundId` | `integer` | Identifier associated with the refund. |
| `Response` → `RefundList` → `Created` | `date` | Date and time when the refund was made. |
| `Response` → `RefundList` → `UniqueID` | `string` | Unique identifier of the transaction.<br>This value allows you to identify a refund in the list of all possible refunds made. |
| `Response` → `RefundList` → `Amount` | `integer` | Total amount of the refund. |
| `Response` → `RefundList` → `Currency` | `string` | Currency of the purchase, according to ISO-4217 (alphanumeric codes). |
| `Response` → `RefundList` → `Status` | `string` | Current status of the refund. |
| `Response` → `CommerceAction` | `object` | This object informs you of the actions you or your customer must take to complete the current purchase process. |
| `Response` → `MetadataOut` | `object` | Additional fields returned by each payment method or acquirer to perform the following steps.<br>For example, this object can have the URL to where you need to redirect the customer or the QR image that has to be scanned by your customer. |
| `Response` → `CrossBorderDataResponse` | `object` | This object has the information about the processed Amounts in the local currency of the selected Country. |
| `Response` → `CrossBorderDataResponse` → `TargetCountryISO` | `string` | Same country sent in the request. |
| `Response` → `CrossBorderDataResponse` → `TargetCurrencyISO` | `string` | Local currency determined for the selected country. |
| `Response` → `CrossBorderDataResponse` → `TargetAmount` | `number` | Purchase amount converted to the local currency. |
| `Errors` | `list` | List of errors that the system can launch during the purchase process. |
| `Errors` → `ErrorCode` | `string` | Error code returned. |
| `Errors` → `Created` | `string` | Date and time when the error was generated. |
| `Errors` → `Message` | `string` | Descriptive text of the error. |
| `Errors` → `Detail` | `string` | Error detail. |

### Response example

```json
{
    "Response": {
        "PurchaseId": 481561,
        "Created": "2023-08-01T20:53:28.309",
        "TrxToken": null,
        "Order": "099927564",
        "Transaction": {
            "TransactionID": 499285,
            "Created": "2023-08-01T20:53:28.310",
            "AuthorizationDate": "2023-08-01T20:53:28.737",
            "TransactionStatusId": 1,
            "Status": "Approved",
            "ErrorCode": null,
            "Description": "",
            "ApprovalCode": "831000",
            "Steps": [
                {
                    "Step": "Generic External",
                    "Created": "2023-08-01T20:53:28.650",
                    "Status": "Authorization OK - Step 1",
                    "ResponseCode": "200",
                    "ResponseMessage": "OK",
                    "Error": "",
                    "AuthorizationCode": null,
                    "UniqueID": null,
                    "AcquirerResponseDetail": "{\"card\":{\"type\":\"C\",\"issuer\":\"424242\",\"isLocal\":true},\"allowedInstallments\":[1,2,3],\"currency\":858,\"authorizationAmount\":100.0,\"discountAmount\":0.0,\"discountPoints\":0,\"lawLimitApplied\":false,\"code\":0,\"message\":\"ok\"}"
                },
                {
                    "Step": "Generic External",
                    "Created": "2023-08-01T20:53:28.730",
                    "Status": "Authorization OK",
                    "ResponseCode": "100",
                    "ResponseMessage": "ACCEPT",
                    "Error": "",
                    "AuthorizationCode": "831000",
                    "UniqueID": null,
                    "AcquirerResponseDetail": "{\"Decision\":\"ACCEPT\",\"ReasonCode\":\"100\",\"RequestID\":\"386631747\",\"PaymentNetworkTransactionID\":\"016153570198200\",\"CvCode\":null,\"MerchantReferenceCode\":\"20201229\",\"AuthorizationCode\":\"831000\"}"
                }
            ]
        },
        "Capture": true,
        "Amount": 10000,
        "OriginalAmount": 10000,
        "TaxableAmount": 0,
        "Tip": 0,
        "Installments": 1,
        "Currency": "UYU",
        "Description": null,
        "Customer": {
            "CustomerId": 247720,
            "Created": "2023-08-01T20:53:16.073",
            "CommerceCustomerId": null,
            "Owner": "Anonymous",
            "Email": "john@mail.com",
            "Enabled": true,
            "ShippingAddress": {
                "AddressId": 0,
                "AddressType": 1,
                "Country": "Uruguay",
                "State": "Montevideo",
                "AddressDetail": "Av. Sarmiento 2260",
                "PostalCode": "150000",
                "City": "Montevideo"
            },
            "Plans": null,
            "AdditionalData": null,
            "PaymentProfiles": [
                {
                    "PaymentProfileId": 252393,
                    "PaymentMediaId": 1,
                    "Created": "2023-08-01T20:53:16.073",
                    "LastUpdate": null,
                    "Brand": "VISA",
                    "CardOwner": "John Smith",
                    "Bin": null,
                    "IssuerBank": "Visa",
                    "Installments": "1;2;3;4;5;6;7;8;9;10;11;12",
                    "Type": "CreditCard",
                    "IdCommerceToken": 0,
                    "Token": null,
                    "Expiration": "202605",
                    "Last4": "0001",
                    "Enabled": null,
                    "DocumentNumber": null,
                    "DocumentTypeId": null,
                    "ExternalValue": null,
                    "AffinityGroup": null
                }
            ],
            "CaptureURL": null,
            "UniqueID": null,
            "URL": "https://testapi.siemprepago.com/v1/api/Customer/247720",
            "FirstName": "John",
            "LastName": "Smith",
            "DocNumber": "12345672",
            "DocumentTypeId": 2,
            "PhoneNumber": "24022330",
            "ExternalValue": null
        },
        "RefundList": null,
        "PlanID": null,
        "UniqueID": null,
        "AdditionalData": null,
        "CustomerUserAgent": null,
        "CustomerIP": null,
        "URL": "https://testapi.siemprepago.com/v1/api/Purchase/481561",
        "DataUY": {
            "IsFinalConsumer": "true",
            "Invoice": "1000",
            "TaxableAmount": 0
        },
        "DataDO": null,
        "Acquirer": {
            "AcquirerID": 77,
            "Name": "VisaNetUYv2",
            "CommerceNumber": null
        },
        "CommerceAction": null,
        "PurchasePaymentProfileId": 252393,
        "LoyaltyPlan": null,
        "DeviceFingerprintId": null,
        "MetadataIn": null,
        "MetadataOut": null,
        "CrossBorderData": null,
        "CrossBorderDataResponse": null,
        "Redirection": null,
        "AntifraudData": {
            "AntifraudFingerprintId": null,
            "AntifraudMetadataIn": null
        },
        "PaymentMediaId": null,
        "TargetCountryISO": null,
        "PurchaseType": 1,
        "IsFirstRecurrentPurchase": false
    },
    "Errors": []
}
```