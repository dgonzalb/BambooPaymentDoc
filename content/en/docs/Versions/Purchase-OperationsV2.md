---
title: "Operations V2"
linkTitle: "Operations V2"
date: 2023-03-02T11:40:29-05:00
Description: >
  Create a purchase using the API flow providing its basic information. Furthermore, explore the different operations over existing purchases.
weight: 10
tags: ["subtopic"]
---

## Configuring the authentication
All methods used in Purchase API require the following authentication headers.

| Key | Value | Comments |
|---|---|---|
| `Content-Type` | `application/json` | With this header, the request will be transmitted in _JSON_ format. |
| `Authorization` | `Basic {{Merchant Private Key}}` | Send the `{{Merchant Private Key}}` (your merchant identifier) and the word `Basic`.<br>Example: `Basic RVkeLr-86_iTzSMLvDtuyQ-1zqIcsmFG-oSzncn_uFv-nj7bhB3rtZg__` |

## Setting the language of the response codes
You can receive the error description by relying on localization features. To do this, you need to send the `lang` header in your integration, using any of the following languages in **ISO 639-1** format.

<div id="shortTable"></div>

| Code | Language |
|:-:|---|
| `en` | English.<br>_This is the default language. If you don't send this header or set a non-existent language, you will receive errors in this language._ |
| `es` | Spanish. |
| `pt` | Portuguese. |

## Purchase API methods
The operations exposed by the _**Purchase API**_ allow you to perform several actions over Purchases. You have available the following methods.

* [Create a purchase](#create-a-purchase)
* [Confirm a purchase](#confirm-a-purchase)
* [Get purchases](#get-purchases)

### Create a purchase
Create a basic purchase in Bamboo Payment.

#### Request URL
You must invoke a **POST** request to the following URLs according to your needs.

* **Production**: `https://api.bamboopayment.com/v2/api/purchase`
* **Stage**: `https://api.stage.bamboopayment.com/v2/api/purchase`

#### Request parameters

| Parameter | Type | Mandatory? | Description |
|-----------|------|:----------:|-------------|
| `TrxToken` | `string` | No<sup>1</sup> | Card token, previously generated through the tokenization flow. Used for card payment methods. |
| `NetworkToken` | `object` | No<sup>1</sup> | Network token information used in the transaction. For more information, review the Network Tokenization Object. |
| `PaymentMethodId` | `integer` | No<sup>1</sup> | Payment method identifier. Used only for alternative payment methods (transfer, cash, etc.) |
| `UniqueID` | `string` | No | Unique identifier of the purchase.<br>This optional value allows you to identify a unique purchase and avoid duplication of transactions in case of communication errors. For more information, refer to [Concepts]({{< ref "Concepts.md">}}#UniqueID). |
| `Capture` | `boolean` | No | Defines whether the purchase should be performed in one or two steps.<sup>2</sup><br><ul style="margin-bottom: initial;"><li>If `false`, only the authorization is processed, and the purchase is pre-authorized until the final confirmation through the commit and rollback calls.</li><li>If `true`, the transaction is authorized and captured (committed).</li></ul><br>All [payment methods and countries](/en/docs/payment-methods.html) may not support the pre-authorization feature. |
| `TargetCountryISO` | `string` | Yes | This parameter indicates the country where the payment will be processed.<br>Send the country using `ISO-3166-1` format. |
| `Currency` | `string` | Yes | Currency of the purchase, according to ISO-4217. Find the possible values in the Currencies table of [each country](/en/docs/payment-methods.html). |
| `Amount` | `integer` (64 bits) | Yes | Amount of the purchase. This value must be greater than zero.<br>If you must include decimals in the amount, concatenate the decimal places without the decimal point. Example `12,25` > `1225`. |
| `Tip` | `integer` (64 bits) | No | Tip amount in the transaction. Value with two decimals, without points or commas. |
| `TaxableAmount` | `integer` (64 bits) | No | Taxable amount of the transaction. Value with two decimals, without points or commas. |
| `Installments` | `integer` | No | Number of installments. |
| `Order` | `string` | Yes | Order number generated by the merchant. |
| `InvoiceNumber` | `string` | No | Invoice number associated with the transaction. |
| `Description` | `string` | No <sup>4</sup> | Optional description of the purchase. |
| `AdditionalData` | `string` | No | Additional information that may be relevant to the transaction. |
| `MetadataIn` | `object` | No | Additional transaction data in key-value format. |
| `Customer` | `object` | Yes <sup>3</sup> | The `Customer` object provides the data of the person who performs the purchase. |


##### Customer Object

| Parameter | Type | Mandatory? | Description |
|-----------|------|:----------:|-------------|
| `Customer` → `FirstName` | `string` | No | Customer's first name. |
| `Customer` → `LastName` | `string` | No | Customer's last name. |
| `Customer` → `ReferenceCode` | `string` | No | Reference code for the customer. |
| `Customer` → `PhoneNumber` | `string` | No | Customer's phone number. |
| `Customer` → `DocNumber` | `string` | No | Customer's document number. |
| `Customer` → `DocumentTypeId` | `integer` | No | Document type identifier. |
| `Customer` → `Email` | `string` | No | Customer's email address. |
| `ShippingAddress` | `object` | No | Customer's shipping address. |

##### ShippingAddress Object

| Parameter | Type | Mandatory? | Description |
|-----------|------|:----------:|-------------|
| `ShippingAddress` → `Country` | `string` | No | Country of the shipping address. |
| `ShippingAddress` → `City` | `string` | No | City of the shipping address. |
| `ShippingAddress` → `State` | `string` | No | State or region of the shipping address. |
| `ShippingAddress` → `PostalCode` | `string` | No | Postal code of the shipping address. |
| `ShippingAddress` → `AddressDetail` | `string` | No | Additional details of the shipping address. |



{{% alert title="Notes" color="info"%}}
* <sup>1</sup> The `PaymentMediaId` and `TrxToken` parameters are not required. Nevertheless, sending one of them is mandatory, depending on the flow you want to use.
* <sup>2</sup> All the payment methods may not support the pre-authorization feature. Review the [Countries and payment methods](/en/docs/payment-methods.html) section to check availability.
* <sup>3</sup> This object is not required if you create the purchase using [_CommerceToken_]({{< ref Registered-users.md >}}).
* <sup>4</sup> When using [cards in Brazil]({{< ref br-cards.md>}}), the description is mandatory and must use a fixed format, as explained in the [request parameters]({{< ref br-cards.md>}}#request-parameters).
* Keep in mind that for the Anti-fraud system's correct functioning, we suggest sending additional data described in the [Anti-fraud]({{< ref "Antifraud.md" >}}) section.
* For detailed information about [3D Secure - 3DS]({{< ref "3D_Secure.md" >}}) and [Network Token]({{< ref "Network_Tokens.md" >}}) objects, please refer to their corresponding sections in this documentation.
{{% /alert %}}

##### Request example

```json
{
    "TrxToken": "OT__6dHAgJo6qeg62qIroA7H7_f_NWZZ6IEx4jiYpVJ8SzQ_",
    "UniqueID": "AsadoPurchase2023",
    "Capture": true,
    "TargetCountryISO": "UY",
    "Currency": "UYU",
    "Amount": 125000,
    "Installments": 3,
    "Order": "AS2023-001",
    "Customer": {
        "FirstName": "Carlos",
        "LastName": "Sanchez",
        "ReferenceCode": "CS-001",
        "PhoneNumber": "099123456",
        "DocNumber": "43215678",
        "DocumentTypeId": 2,
        "Email": "carlos.sanchez@example.com",
        "ShippingAddress": {
            "Country": "Uruguay",
            "City": "Montevideo",
            "State": "MVD",
            "PostalCode": "11300",
            "AddressDetail": "Rambla Republica de Mexico 6015"
        }
    }
}
```

### Confirm a purchase
This method allows you to confirm a pre-authorized purchase.

{{% alert title="Note" color="info"%}}
All payment methods may not support the pre-authorization feature, and it’s available for the following countries.

<div style="text-align: center;">

<a href="/en/docs/payment-methods/brazil.html"><img src="/assets/Flags/FlagBR.png" width="30" /></a>
<a href="/en/docs/payment-methods/chile.html"><img src="/assets/Flags/FlagCL.png" width="30" /></a>
<a href="/en/docs/payment-methods/colombia.html"><img src="/assets/Flags/FlagCO.png" width="30" /></a>
<a href="/en/docs/payment-methods/uruguay.html"><img src="/assets/Flags/FlagUY.png" width="30" /></a>

</div>

{{% /alert %}}

#### Request URL
You must invoke a **POST** request to the following URLs according to your needs.

* **Production**: `https://api.bamboopayment.com/v2/api/purchase/{{PurchaseID}}/commit`
* **Stage**: `https://api.stage.bamboopayment.com/v2/api/purchase/{{PurchaseID}}/commit`

#### Request parameters
The request body is optional to confirm a purchase. If you don’t send any request, the method commits the pre-authorized purchase by its original amount.

The purchase amount may vary concerning the one sent in the initial purchase process, but the new amount cannot be higher than the original amount.

##### Request example
You must include the new amount in the request to confirm a purchase with a lower amount than the original. For example:

```json
{
  "Amount": 50
}
``` 

### Get Purchases
This method allows you to get the information of one or more purchases given the search criteria sent in the body.

#### Request URL
You must invoke a**GET** request to the following URLs according to your needs.

* **Production**: `https://api.bamboopayment.com/v2/api/purchase`
* **Stage**: `https://api.stage.bamboopayment.com/v2/api/purchase`

To get a specific purchase, include in the URL `/{{PurchaseID}}`. Example: `https://api.bamboopayment.com/v2/api/purchase/481561`.

#### Request parameters
The following parameters are only required when you want to get a list of purchases. Add the _PurchaseID_ to the Request URL when requesting a specific purchase.

{{% alert title="Note" color="info"%}}
All the parameters are optional. If you don’t send any parameters, all today's purchases will be listed.
{{% /alert %}}

| Parameter | Type | Description |
|---|---|---|---|
| `Authorized` | `boolean` | If the value is `true`, it returns only purchases that have been completed successfully. |
| `From` | `date` | Filter start date.<br>Format: `yyyyMMdd`. |
| `OrderNumber` | `string` | Merchant order number. |
| `PaymentMediaId` | `integer` | Identifier of the Payment Method used in the purchase. |
| `To` | `date` | Filter end date.<br>Format: `yyyyMMdd`. |


## Response parameters


| Parameter | Type | Description |
|---|---|---|
| `TransactionId` | `string` | Unique identifier for the transaction. A 19-digit number sent as a string for compatibility. |
| `Result` | `string` | Outcome of the transaction. `COMPLETED` or `ACTION_REQUIRED`. See the "Action" object for instructions. |
| `Status` | `string` | Current status of the transaction (e.g., Approved, Rejected). |
| `ErrorCode` | `string` | Error code if the transaction was rejected. |
| `ErrorDescription` | `string` | Detailed description of the error if the transaction was rejected. |
| `Created` | `string` | Timestamp of when the transaction was created, in **ISO 8601** format. |
| `AuthorizationDate` | `string` | Timestamp of when the transaction was authorized, in **ISO 8601** format. |
| `AuthorizationCode` | `string` | Unique code provided by the issuer to confirm the transaction authorization. |
| `Amount` | `integer` | Total transaction amount. |
| `Currency` | `string` | Currency code used for the transaction. May differ from the request currency based on business agreements. |
| `Installments` | `integer` | Number of payment installments for the transaction. |
| `TaxableAmount` | `integer` | Amount subject to taxes. |
| `Tip` | `integer` | Tip amount. |
| `Url` | `string` | Link to access additional transaction details. |
| `MetadataOut` | `object` | Additional metadata returned with the transaction response. |
| `Action` | `object` | Details of required actions when Result is "ACTION_REQUIRED". |
| `PaymentMethod` | `object` | Information about the payment method used for the transaction. |
| `Customer` | `object` | Details of the customer associated with the transaction. |


### Response example

```json
{
    "TransactionId": "79632697147789184",
    "Result": "COMPLETED",
    "Status": "Approved",
    "ErrorCode": null,
    "ErrorDescription": null,
    "Created": "2024-08-07T17:51:54.620",
    "AuthorizationDate": "2024-08-07T17:51:56.879",
    "AuthorizationCode": "839936",
    "Amount": 10000,
    "Currency": "UYU",
    "Installments": 1,
    "TaxableAmount": 23,
    "Tip": 101,
    "Url": "https://api.stage.bamboopayment.com/Purchase/79632697147789184",
    "MetadataOut": null,
    "Action": null,
    "PaymentMethod": {
        "Brand": "MasterCard",
        "CardOwner": "Bamboo Payment",
        "Bin": "538983",
        "IssuerBank": "Santander",
        "Type": "CreditCard",
        "Expiration": "202912",
        "Last4": "8983",
        "DocumentNumber": "12345678",
        "DocumentTypeId": 2
    },
    "Customer": {
        "CustomerId": 361800,
        "FirstName": "name",
        "LastName": "lastname",
        "DocumentNumber": "12345678",
        "DocumentTypeId": 2,
        "PhoneNumber": "12345678989",
        "Email": "customer@bamboopayment.com",
        "PaymentProfile": {
            "PaymentProfileId": 373566,
            "Token": "CT__pYl7KBgTfLX4fjpkSYqVyZDrmgmCH9BD4jiYpVJ8SzQ_"
        }
    }
}
```